<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>For Shreya üíñ</title>

  <style>
    :root{
      --bg1:#fff1f6;
      --bg2:#ffe6f1;
      --card:#ffffffde;
      --text:#1f1f1f;
      --pink:#ff2f7d;
      --pink2:#ff7fb4;
      --shadow: 0 22px 70px rgba(255,47,125,.22);
      --softShadow: 0 12px 26px rgba(0,0,0,.10);
      --border: 1px solid rgba(0,0,0,.06);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      display:grid;
      place-items:center;
      overflow:hidden;
      background:
        radial-gradient(1200px 800px at 12% 12%, #ffd2e6 0%, transparent 55%),
        radial-gradient(1000px 700px at 88% 35%, #ffe9f2 0%, transparent 60%),
        linear-gradient(135deg,var(--bg1),var(--bg2));
    }

    /* floating hearts (subtle) */
    .heart{
      position:absolute;
      width:16px;height:16px;
      transform: rotate(45deg);
      background: rgba(255,47,125,.18);
      border-radius:4px;
      animation: floatUp 11s linear infinite;
      opacity:.75;
      pointer-events:none;
    }
    .heart:before,.heart:after{
      content:"";
      position:absolute;
      width:16px;height:16px;
      background: inherit;
      border-radius:50%;
    }
    .heart:before{ left:-8px; top:0;}
    .heart:after{ top:-8px; left:0;}
    @keyframes floatUp{
      from{ transform: translateY(30vh) rotate(45deg); }
      to{ transform: translateY(-120vh) rotate(45deg); }
    }

    /* floating nickname words */
    .floatWord{
      position:absolute;
      left:0; top:0;
      font-weight:900;
      letter-spacing:-.02em;
      padding:8px 12px;
      border-radius:999px;
      border: 1px solid rgba(255,47,125,.18);
      background: rgba(255,255,255,.55);
      backdrop-filter: blur(8px);
      box-shadow: 0 10px 26px rgba(255,47,125,.10);
      color: rgba(31,31,31,.72);
      pointer-events:none;
      user-select:none;
      white-space:nowrap;
      transform: translate(-50%,-50%);
      opacity:.95;
      animation: drift 16s linear infinite;
      font-size: 13px;
    }
    .floatWord b{ color: rgba(255,47,125,.95); }
    @keyframes drift{
      0%   { transform: translate(-50%,-50%) translateY(30vh); opacity:0; }
      10%  { opacity:.95; }
      100% { transform: translate(-50%,-50%) translateY(-120vh); opacity:0; }
    }

    .wrap{
      width:min(980px, 94vw);
      padding:22px;
      position:relative;
      z-index:2;
    }

    .card{
      background:var(--card);
      border:1px solid rgba(255,255,255,.6);
      border-radius:28px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      padding:22px 18px;
      position:relative;
      overflow:hidden;
    }

    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background: rgba(255,47,125,.10);
      border:1px solid rgba(255,47,125,.18);
      font-weight:900;
      font-size:13px;
    }
    .progress{
      font-size:13px;
      opacity:.75;
      white-space:nowrap;
    }

    h1{
      margin:10px 0 8px;
      font-size: clamp(22px, 4vw, 34px);
      letter-spacing:-.02em;
      line-height:1.12;
    }
    p{
      margin:8px 0;
      font-size:15.5px;
      line-height:1.7;
      opacity:.95;
    }

    .scene{ display:none; animation: in .45s ease; }
    .scene.active{ display:block; }
    @keyframes in{ from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)} }

    .pillrow{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background: rgba(255,47,125,.09);
      border:1px solid rgba(255,47,125,.16);
      font-size:13px;
      font-weight:900;
      color: rgba(31,31,31,.86);
    }

    .bubble{
      background: rgba(255,255,255,.78);
      border:var(--border);
      border-radius:18px;
      padding:14px;
      margin-top:14px;
      box-shadow: 0 10px 22px rgba(0,0,0,.04);
    }

    .note{
      margin-top:14px;
      padding:12px 14px;
      border-radius:16px;
      background: rgba(255,47,125,.07);
      border:1px solid rgba(255,47,125,.14);
    }
    .note .sign{
      margin-top:10px;
      font-weight:900;
      color: rgba(31,31,31,.90);
    }
    .note .sign span{ color: var(--pink); }

    .media{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:center;
      margin-top:12px;
    }
    .media img{
      width: min(360px, 88vw);
      border-radius:18px;
      border: var(--border);
      box-shadow: var(--softShadow);
      object-fit:cover;
    }
    .caption{
      text-align:center;
      font-size:12.5px;
      opacity:.72;
      margin-top:8px;
    }

    /* NAV: sticky so poem doesn't feel "stuck" */
    .nav{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:16px;
      align-items:center;
      justify-content:space-between;

      position: sticky;
      bottom: 12px;
      background: rgba(255,255,255,.78);
      border: var(--border);
      border-radius: 18px;
      padding: 10px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
      z-index: 5;
    }

    .navTop{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
      align-items:center;
      justify-content:space-between;
    }

    button{
      border:0;
      border-radius:16px;
      padding:12px 14px;
      font-weight:950;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease;
      user-select:none;
    }
    button:hover{ transform: translateY(-1px); filter: brightness(1.02); }

    .btn{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:white;
      box-shadow: 0 12px 24px rgba(255,47,125,.22);
    }
    .btn2{
      background: rgba(0,0,0,.06);
      color:#333;
    }

    .footer{
      text-align:center;
      font-size:12px;
      opacity:.7;
      margin-top:12px;
    }

    .bigheart{
      font-size:54px;
      display:inline-block;
      animation: thump 1.2s ease-in-out infinite;
      filter: drop-shadow(0 10px 18px rgba(255,47,125,.18));
      margin:6px 0 2px;
    }
    @keyframes thump{ 0%,100%{transform:scale(1)} 50%{transform:scale(1.08)} }

    .yesArea{
      margin-top:16px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
    }
    .no-wrap{ position:relative; display:inline-block; }

    .sparkle{
      position:absolute;
      pointer-events:none;
      width:10px;height:10px;
      border-radius:50%;
      background: rgba(255,47,125,.7);
      transform: translate(-50%,-50%);
      animation: pop .55s ease-out forwards;
      filter: blur(.2px);
    }
    @keyframes pop{
      0%{ opacity:0; transform: translate(-50%,-50%) scale(.6); }
      20%{ opacity:1; }
      100%{ opacity:0; transform: translate(-50%,-70%) scale(1.6); }
    }

    .poem{
      line-height:1.9;
      font-size:15px;
    }
    .poem p{ margin: 12px 0; }

    /* Music pill */
    .musicPill{
      position:fixed;
      right:14px;
      bottom:14px;
      z-index:10;
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.78);
      border: var(--border);
      box-shadow: 0 10px 22px rgba(0,0,0,.10);
      backdrop-filter: blur(10px);
    }
    .musicDot{
      width:10px;height:10px;border-radius:50%;
      background: rgba(255,47,125,.9);
      box-shadow: 0 0 0 6px rgba(255,47,125,.12);
    }
    .musicLabel{
      font-size:12.5px;
      font-weight:900;
      opacity:.85;
      white-space:nowrap;
    }
    .musicBtn{
      padding:10px 12px;
      border-radius:999px;
      font-weight:950;
    }

    audio{
      width:100%;
      max-width:360px;
    }
  </style>
</head>

<body>
  <script>
    // soft background hearts
    const heartCount = 18;
    for(let i=0;i<heartCount;i++){
      const h=document.createElement('div');
      h.className='heart';
      h.style.left = Math.random()*100+'vw';
      h.style.animationDuration = (8+Math.random()*10)+'s';
      h.style.animationDelay = (-Math.random()*14)+'s';
      const s = 10 + Math.random()*18;
      h.style.width = s+'px';
      h.style.height = s+'px';
      h.style.opacity = 0.25 + Math.random()*0.45;
      document.body.appendChild(h);
    }
  </script>

  <!-- Background music (won't autoplay on phones; user taps Play once) -->
  <audio id="bgm" src="music.mp3" loop preload="none"></audio>

  <div class="musicPill" aria-label="music control">
    <div class="musicDot" id="musicDot"></div>
    <div class="musicLabel" id="musicLabel">Music: Off</div>
    <button class="btn2 musicBtn" id="musicToggle">Play</button>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="top">
        <div class="badge">üíå For <span id="herName"></span></div>
        <div class="progress" id="progress"></div>
      </div>

      <div id="scenes"></div>

      <div class="footer">Made by Samarpan ‚Äî quietly, carefully, and with love üíó</div>
    </div>
  </div>

  <script>
    // ===== Customize =====
    const NAME = "Shreya";
    const YOUR_NAME = "Samarpan";

    // Put these files in the same GitHub repo folder as index.html:
    const COUPLE_PHOTO = "us.jpg";     // e.g. us.jpg or us.png
    const VOICE_NOTE   = "shreya.mp3"; // mp3 recommended
    const BGM_FILE     = "music.mp3";  // background music file
    // =====================

    document.getElementById("herName").textContent = NAME;

    const scenesEl = document.getElementById("scenes");
    const progressEl = document.getElementById("progress");

    // --- Music controls ---
    const bgm = document.getElementById("bgm");
    bgm.src = BGM_FILE;
    const musicToggle = document.getElementById("musicToggle");
    const musicLabel = document.getElementById("musicLabel");
    const musicDot = document.getElementById("musicDot");

    function setMusicUI(isOn){
      musicLabel.textContent = "Music: " + (isOn ? "On" : "Off");
      musicToggle.textContent = isOn ? "Pause" : "Play";
      musicDot.style.opacity = isOn ? "1" : ".45";
    }

    // Remember if user turned music on (so it stays on between page changes)
    const savedMusic = localStorage.getItem("bgm_on") === "1";
    setMusicUI(false);

    async function tryPlay(){
      try{
        await bgm.play();
        localStorage.setItem("bgm_on","1");
        setMusicUI(true);
      }catch(e){
        // mobile blocks autoplay; user must tap play (this is okay)
        setMusicUI(false);
      }
    }

    function pauseMusic(){
      bgm.pause();
      localStorage.setItem("bgm_on","0");
      setMusicUI(false);
    }

    musicToggle.addEventListener("click", async ()=>{
      if(bgm.paused) await tryPlay();
      else pauseMusic();
    });

    // attempt to resume if previously on (will only succeed after a user gesture on some phones)
    if(savedMusic){
      // don't force; keep UI accurate after first gesture
      setMusicUI(false);
    }

    // --- Background floating nickname words ---
    const nicknames = [
      {t:"Chaakey", e:"üíò"},
      {t:"Sanu", e:"üåô"},
      {t:"Baby", e:"üíã"},
      {t:"Mrs Thapa", e:"üåπ"},
      {t:"Chaakey", e:"ü´Ç"},
      {t:"Sanu", e:"üíû"},
      {t:"Baby", e:"üç´"},
      {t:"Mrs Thapa", e:"üß∏"}
    ];

    function spawnWord(){
      const w = document.createElement("div");
      w.className = "floatWord";
      const pick = nicknames[Math.floor(Math.random()*nicknames.length)];
      // Position somewhere across width; start lower area
      w.style.left = (6 + Math.random()*88) + "vw";
      w.style.top  = (70 + Math.random()*25) + "vh";

      // Size + speed variation
      const size = 12 + Math.random()*6;
      w.style.fontSize = size + "px";
      const dur = 12 + Math.random()*10;
      w.style.animationDuration = dur + "s";
      w.style.animationDelay = (-Math.random()*dur) + "s";
      w.style.opacity = (0.75 + Math.random()*0.25).toFixed(2);

      w.innerHTML = `<b>${pick.t}</b> ${pick.e}`;
      document.body.appendChild(w);

      // remove eventually
      setTimeout(()=>w.remove(), (dur+2)*1000);
    }

    // spawn a few initially + then occasionally
    for(let i=0;i<10;i++) spawnWord();
    setInterval(()=>spawnWord(), 1200);

    // --- sparkle on click ---
    function sparkle(x,y){
      const s=document.createElement('div');
      s.className='sparkle';
      s.style.left = x+'px';
      s.style.top = y+'px';
      document.body.appendChild(s);
      setTimeout(()=>s.remove(), 600);
    }

    // --- Scene template ---
    function tplScene({title, dayLabel, pills=[], bodyHTML="", showPhoto=false, showVoice=false, final=false, isPoem=false}) {
      const wrap = document.createElement("div");
      wrap.className = "scene";

      const pillsHTML = pills.length
        ? `<div class="pillrow">${pills.map(t=>`<div class="pill">${t}</div>`).join("")}</div>`
        : "";

      const dayHTML = dayLabel
        ? `<div class="pillrow"><div class="pill">${dayLabel}</div></div>`
        : "";

      const photoHTML = (showPhoto && COUPLE_PHOTO)
        ? `
          <div class="media">
            <img src="${COUPLE_PHOTO}" alt="us" loading="lazy">
          </div>
          <div class="caption">Us. A calm kind of happiness.</div>
        ` : "";

      const voiceHTML = (showVoice && VOICE_NOTE)
        ? `
          <div class="bubble" style="margin-top:14px; text-align:center;">
            <p style="margin:0; font-weight:950;">Press play when you‚Äôre alone.</p>
            <p style="margin:6px 0 12px; opacity:.75;">(My voice. No performance. Just me.)</p>
            <audio controls preload="none">
              <source src="${VOICE_NOTE}" type="audio/mpeg">
              Your browser does not support audio playback.
            </audio>
          </div>
        ` : "";

      // poem page gets a top nav so it never feels stuck
      const poemTopNav = isPoem ? `
        <div class="navTop">
          <button class="btn2" id="prevBtnTop">‚Üê Back</button>
          <button class="btn" id="nextBtnTop">Next ‚Üí</button>
        </div>
      ` : "";

      wrap.innerHTML = `
        <h1>${title}</h1>
        ${dayHTML}
        ${pillsHTML}
        ${poemTopNav}
        <div class="bubble">${bodyHTML}</div>
        ${voiceHTML}
        ${photoHTML}
        ${final ? `
          <div class="yesArea">
            <button class="btn" id="yesBtn">Yes üíû</button>
            <span class="no-wrap">
              <button class="btn2" id="noBtn">No üò∂</button>
            </span>
          </div>
          <div class="caption" id="noHint">You can answer honestly‚Ä¶ but the ‚ÄúNo‚Äù button has commitment issues.</div>
        ` : `
          <div class="nav">
            <button class="btn2" id="prevBtn">‚Üê Back</button>
            <button class="btn" id="nextBtn">Next ‚Üí</button>
          </div>
        `}
      `;

      return wrap;
    }

    // --- High-quality writing per day (funny but not cheap) ---
    const VAL_WEEK = [
      {
        day: "Welcome",
        title: `Hi ${NAME}.`,
        dayLabel: "A small collection of big feelings üíó",
        pills: ["Chaakey ‚Ä¢ Sanu ‚Ä¢ Baby ‚Ä¢ Mrs Thapa", "Handmade, not copied"],
        bodyHTML: `
          <p>
            This isn‚Äôt meant to impress the internet.
            It‚Äôs meant to reach <b>you</b>.
          </p>
          <p>
            I know you already know I love you.
            This is me doing it again ‚Äî but more carefully, more intentionally.
          </p>

          <div class="note">
            <p style="margin:0;">
              I‚Äôm not going to ask you ‚Äúwhat you like.‚Äù
              I‚Äôve had five years of research, observations, and professional-level missing-you.
            </p>
            <p class="sign">‚Äî Your impatient <span>${YOUR_NAME}</span> üíò</p>
          </div>

          <p style="opacity:.82; margin-top:12px;">
            Start the music if you want. Then go page by page.
          </p>
        `
      },

      {
        day: "Rose Day",
        title: "Rose Day",
        dayLabel: "üåπ",
        pills: ["Soft", "Simple", "For you"],
        bodyHTML: `
          <p>
            If I were there, I‚Äôd give you a rose in real life and pretend I‚Äôm smooth.
            (I am not. But I would try bravely.)
          </p>
          <p>
            So here‚Äôs the honest version:
            you make my life feel less noisy.
            You‚Äôre the calm I didn‚Äôt know I needed.
          </p>
          <p>
            And yes ‚Äî this is me giving you a rose from far away, with full sincerity and zero cringe.
          </p>
        `
      },

      {
        day: "Propose Day",
        title: "Propose Day",
        dayLabel: "üíç",
        pills: ["No speech", "No drama", "Just truth"],
        bodyHTML: `
          <p>
            I‚Äôm not proposing with a crowd, a camera, or a dramatic soundtrack.
          </p>
          <p>
            I‚Äôm proposing with the most serious thing I have:
            <b>consistency</b>.
          </p>
          <p>
            I choose you in the small moments ‚Äî
            the random check-ins, the long calls, the patience during distance,
            the way I still want you at the end of the day.
          </p>
          <p>
            So yes, this is a proposal:
            keep being my person.
          </p>
        `
      },

      {
        day: "Chocolate Day",
        title: "Chocolate Day",
        dayLabel: "üç´",
        pills: ["Sweet", "Warm", "A little dangerous"],
        bodyHTML: `
          <p>
            Chocolate day is basically the universe admitting that sweetness is a need, not a luxury.
          </p>
          <p>
            If I were there, you‚Äôd get chocolate and I‚Äôd still try to steal a bite ‚Äî
            then deny it with full confidence.
          </p>
          <p>
            Today I‚Äôm sending you the long-distance version:
            a reminder that you deserve softness, comfort, and being cared for.
          </p>
        `
      },

      {
        day: "Teddy Day",
        title: "Teddy Day",
        dayLabel: "üß∏",
        pills: ["Cuddly", "Safe", "Not negotiable"],
        bodyHTML: `
          <p>
            Teddy Day is for soft things.
            So is my love for you.
          </p>
          <p>
            If I could, I‚Äôd replace your pillow for one night ‚Äî
            just to win a very petty competition.
          </p>
          <p>
            Consider this a reminder that you are held ‚Äî
            even when we‚Äôre not in the same room.
          </p>
        `
      },

      {
        day: "Promise Day",
        title: "Promise Day",
        dayLabel: "ü§ù",
        pills: ["Effort", "Respect", "Home in a person"],
        bodyHTML: `
          <p>
            My promises aren‚Äôt dramatic.
            They‚Äôre practical ‚Äî the kind that actually shows up.
          </p>
          <p>
            I promise to keep choosing you gently,
            to protect your peace,
            and to love you in ways that feel safe, not loud.
          </p>
          <p>
            And I promise I won‚Äôt forget the things that made us <i>us</i>:
            our first date,
            that full moon at Patan Mandir,
            and momo in Patan ko Galli ‚Äî laughing like nothing else mattered.
          </p>
        `
      },

      // Quiet poem interlude ‚Äî she recognizes it herself
      {
        day: "Poem",
        title: "üåô",
        dayLabel: "",
        pills: ["(no explanation)", "just a page from then"],
        isPoem: true,
        bodyHTML: `
          <p style="opacity:.85; font-style:italic; margin-top:0;">
            I found something I wrote years ago.<br>
            I won‚Äôt explain it.<br>
            I‚Äôll just leave it here.
          </p>

          <div class="poem">
            <p>
              If only I could own my dreams,<br>
              With sleepless night, I would trade all of it.<br>
              Telling the birds to sleep early and quiet,<br>
              Even the leaves wouldn‚Äôt make any noise.
            </p>

            <p>
              And here I hold my breath all so tight<br>
              For listening you breathe all whole night
            </p>

            <p>
              If morning were endless<br>
              And you drizzle like rain
            </p>

            <p>
              I could be an ocean receiving all your pain.
            </p>

            <p>
              Let the pain move like waves between shores of our souls<br>
              And embrace each other until it utterly goes
            </p>

            <p>
              Unite our soul, make it whole and make those pain never shows again<br>
              And tell our tale to the clouds as they listen cravingly, the pelting rain
            </p>

            <p>
              The worst things about mornings and nights,<br>
              They always end
            </p>

            <p>
              I pass the time in between, counting hours, till comes the another night<br>
              My heart, I love you with all my soul and with all my might
            </p>

            <p>
              Among all the loveliest things, you are the only one precious, I have.<br>
              For length of my love is far greater than length of my life
            </p>

            <p>
              Give me a little of you dear, and I will give you all of mine
            </p>

            <p>
              If I could stop my heart from loving you<br>
              Then I shall remain heartless<br>
              For there‚Äôs nothing I would rather do<br>
              Than spending my whole life loving only you.
            </p>

            <p style="margin-top:18px; font-weight:950;">
              ‚Äî ${YOUR_NAME}
            </p>
          </div>
        `
      },

      {
        day: "Hug Day",
        title: "Hug Day",
        dayLabel: "ü´Ç",
        pills: ["Tight", "Quiet", "Exactly what I want"],
        bodyHTML: `
          <p>
            Hug Day feels unfair when we‚Äôre apart.
            So I‚Äôm doing this the only way I can:
            carefully, intentionally, and with full affection.
          </p>

          <div class="note">
            <p style="margin:0;">
              Close your eyes for two seconds.
              Imagine my arms around you ‚Äî not rushing, not letting go too fast.
              Just‚Ä¶ staying.
            </p>
            <p class="sign">‚Äî ${YOUR_NAME} ü´Ç</p>
          </div>

          <p style="margin-top:12px;">
            Also yes: the distance is annoying.
            But it‚Äôs never been stronger than what we built.
          </p>
        `
      },

      {
        day: "Kiss Day",
        title: "Kiss Day",
        dayLabel: "üíã",
        pills: ["Romantic", "Respectful", "Slightly chaotic"],
        bodyHTML: `
          <p>
            I owe you kisses in bulk.
            The kind that says ‚ÄúI‚Äôm here,‚Äù even when I‚Äôm not physically there.
          </p>

          <div class="note">
            <p style="margin:0;">
              And yes ‚Äî we must acknowledge the national event:
              <b>the day I didn‚Äôt eat ice-cream through your mouth.</b>
              I still don‚Äôt know whether I was being innocent or just trying to survive.
            </p>
            <p class="sign">‚Äî still scared, <span>${YOUR_NAME}</span> üç¶</p>
          </div>

          <p style="margin-top:12px;">
            If you‚Äôre mad about it again, that‚Äôs fine.
            I‚Äôll apologize properly ‚Äî in person ‚Äî with interest.
          </p>
        `
      },

      {
        day: "Valentine",
        title: `${NAME}‚Ä¶`,
        dayLabel: "üíò",
        pills: ["Chaakey", "Sanu", "Baby", "Mrs Thapa"],
        showVoice: true,
        showPhoto: true,
        final: true,
        bodyHTML: `
          <p>
            I don‚Äôt love you because of a list.
            I love you because life feels more like itself when you‚Äôre in it.
          </p>
          <p>
            You‚Äôre the person I want to tell things to.
            The person I miss in small moments.
            The person I choose ‚Äî even on ordinary days.
          </p>
          <div class="note">
            <p style="margin:0;">
              So here‚Äôs the whole point of this page:
              <b>Will you be my Valentine?</b>
            </p>
            <p class="sign">‚Äî ${YOUR_NAME} üíó</p>
          </div>
        `
      }
    ];

    // build scenes
    const sceneNodes = VAL_WEEK.map((d) => tplScene({
      title: d.title,
      dayLabel: d.dayLabel,
      pills: d.pills || [],
      bodyHTML: d.bodyHTML || "",
      showPhoto: !!d.showPhoto,
      showVoice: !!d.showVoice,
      final: !!d.final,
      isPoem: !!d.isPoem
    }));

    sceneNodes.forEach(n => scenesEl.appendChild(n));

    let idx = 0;

    function updateProgress(){
      progressEl.textContent = `${idx+1} / ${VAL_WEEK.length}`;
    }

    function bindNav(active){
      const prev = active.querySelector("#prevBtn");
      const next = active.querySelector("#nextBtn");
      if(prev) prev.onclick = (e)=>{ sparkle(e.clientX, e.clientY); show(idx-1); };
      if(next) next.onclick = (e)=>{ sparkle(e.clientX, e.clientY); show(idx+1); };

      // poem top nav
      const prevTop = active.querySelector("#prevBtnTop");
      const nextTop = active.querySelector("#nextBtnTop");
      if(prevTop) prevTop.onclick = (e)=>{ sparkle(e.clientX, e.clientY); show(idx-1); };
      if(nextTop) nextTop.onclick = (e)=>{ sparkle(e.clientX, e.clientY); show(idx+1); };
    }

    // Final scene: playful "No" button that dodges but doesn't feel cheap
    function bindFinal(active){
      const yes = active.querySelector("#yesBtn");
      const no  = active.querySelector("#noBtn");
      const hint = active.querySelector("#noHint");
      const wrap = active.querySelector(".no-wrap");

      let noDodges = 0;
      const noPhrases = [
        "Are you sure? ü•∫",
        "Pause. Think again. üò≠",
        "That option seems‚Ä¶ inconsistent with reality.",
        "Your finger slipped. Try again üòå",
        "What if‚Ä¶ yes? (just exploring) üò≥",
        "I‚Äôm going to be dramatically sad. Quietly.",
        "That‚Äôs illegal in my heart‚Äôs constitution üöîüíò",
        "The universe rejects this input üåå",
        "I asked nicely though ü•π",
        "Last chance‚Ä¶ please? üçì"
      ];

      function dodge(){
        noDodges++;
        if(hint) hint.textContent = noPhrases[Math.min(noDodges-1, noPhrases.length-1)];

        const cardRect = document.querySelector(".card").getBoundingClientRect();
        const maxX = Math.max(0, Math.min(220, cardRect.width - 180));
        const maxY = 50;

        const x = (Math.random()*maxX) - (maxX/2);
        const y = (Math.random()*maxY) - (maxY/2);

        if(wrap){
          wrap.style.transform = `translate(${x}px, ${y}px)`;
          wrap.style.transition = "transform .12s ease";
        }

        if(noDodges >= 10 && no) no.textContent = "I‚Äôm shy üôà";
        if(noDodges >= 14 && no){
          no.textContent = "Okay fine‚Ä¶ click me";
          no.removeEventListener("mouseenter", dodge);
          no.removeEventListener("touchstart", dodge);
        }
      }

      if(yes){
        yes.onclick = async (e)=>{
          sparkle(e.clientX, e.clientY);

          // If she taps yes and music was previously on, try to start it now (this click counts as a gesture)
          if(localStorage.getItem("bgm_on") === "1" && bgm.paused) {
            await tryPlay();
          }

          alert(`YAY üíñ\n\nOfficially confirmed:\n${NAME} is my Valentine.\n\n‚Äî ${YOUR_NAME}`);
        };
      }

      if(no){
        no.addEventListener("mouseenter", dodge);
        no.addEventListener("touchstart", (e)=>{ e.preventDefault(); dodge(); }, {passive:false});
        no.onclick = (e)=>{
          sparkle(e.clientX, e.clientY);
          alert("Nice try üòå\nThis option has been politely rejected by the Romance Department‚Ñ¢.");
        };
      }
    }

    function show(i){
      idx = Math.max(0, Math.min(i, sceneNodes.length-1));
      document.querySelectorAll(".scene").forEach(s => s.classList.remove("active"));
      const active = sceneNodes[idx];
      active.classList.add("active");
      updateProgress();

      bindNav(active);
      bindFinal(active);

      // After user has interacted once, try to honor saved music preference
      // (won't autoplay on some phones until they press Play; that‚Äôs normal)
      if(savedMusic && bgm.paused){
        // keep UI "off" until it actually plays
        setMusicUI(!bgm.paused);
      }

      window.scrollTo({top:0, behavior:"smooth"});
    }

    show(0);
  </script>
</body>
</html>
