<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>For Shreya üíò</title>

  <style>
    :root{
      --bg1:#fff1f6;
      --bg2:#ffe6f1;
      --card:#ffffffde;
      --text:#1f1f1f;
      --pink:#ff2f7d;
      --pink2:#ff7fb4;
      --shadow: 0 22px 70px rgba(255,47,125,.22);
      --border: 1px solid rgba(0,0,0,.06);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      display:grid;
      place-items:center;
      overflow:hidden;
      background:
        radial-gradient(1200px 800px at 12% 12%, #ffd2e6 0%, transparent 55%),
        radial-gradient(1000px 700px at 88% 35%, #ffe9f2 0%, transparent 60%),
        linear-gradient(135deg,var(--bg1),var(--bg2));
    }

    /* background hearts */
    .heart{
      position:absolute;
      width:16px;height:16px;
      transform: rotate(45deg);
      background: rgba(255,47,125,.18);
      border-radius:4px;
      animation: floatUp 11s linear infinite;
      opacity:.75;
      pointer-events:none;
    }
    .heart:before,.heart:after{
      content:"";
      position:absolute;
      width:16px;height:16px;
      background: inherit;
      border-radius:50%;
    }
    .heart:before{ left:-8px; top:0;}
    .heart:after{ top:-8px; left:0;}
    @keyframes floatUp{
      from{ transform: translateY(30vh) rotate(45deg); }
      to{ transform: translateY(-120vh) rotate(45deg); }
    }

    /* floating nickname chips */
    .floatWord{
      position:absolute;
      font-weight:900;
      letter-spacing:-.02em;
      padding:8px 12px;
      border-radius:999px;
      border: 1px solid rgba(255,47,125,.18);
      background: rgba(255,255,255,.55);
      backdrop-filter: blur(8px);
      box-shadow: 0 10px 26px rgba(255,47,125,.10);
      color: rgba(31,31,31,.72);
      pointer-events:none;
      user-select:none;
      white-space:nowrap;
      transform: translate(-50%,-50%);
      opacity:.95;
      animation: drift 16s linear infinite;
      font-size: 13px;
      z-index:1;
    }
    .floatWord b{ color: rgba(255,47,125,.95); }
    @keyframes drift{
      0%   { transform: translate(-50%,-50%) translateY(30vh); opacity:0; }
      10%  { opacity:.95; }
      100% { transform: translate(-50%,-50%) translateY(-120vh); opacity:0; }
    }

    .wrap{
      width:min(980px, 94vw);
      padding:22px;
      position:relative;
      z-index:2;
    }

    .card{
      background:var(--card);
      border:1px solid rgba(255,255,255,.6);
      border-radius:28px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      padding:22px 18px;
      position:relative;
      overflow:hidden;
    }

    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background: rgba(255,47,125,.10);
      border:1px solid rgba(255,47,125,.18);
      font-weight:900;
      font-size:13px;
    }
    .progress{
      font-size:13px;
      opacity:.75;
      white-space:nowrap;
    }

    h1{
      margin:10px 0 8px;
      font-size: clamp(22px, 4vw, 34px);
      letter-spacing:-.02em;
      line-height:1.12;
    }
    p{
      margin:8px 0;
      font-size:15.5px;
      line-height:1.7;
      opacity:.95;
    }

    .scene{ display:none; animation: in .45s ease; }
    .scene.active{ display:block; }
    @keyframes in{ from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)} }

    .pillrow{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background: rgba(255,47,125,.09);
      border:1px solid rgba(255,47,125,.16);
      font-size:13px;
      font-weight:900;
      color: rgba(31,31,31,.86);
    }

    .bubble{
      background: rgba(255,255,255,.78);
      border:var(--border);
      border-radius:18px;
      padding:14px;
      margin-top:14px;
      box-shadow: 0 10px 22px rgba(0,0,0,.04);
    }

    .note{
      margin-top:14px;
      padding:12px 14px;
      border-radius:16px;
      background: rgba(255,47,125,.07);
      border:1px solid rgba(255,47,125,.14);
    }
    .sign{
      margin-top:10px;
      font-weight:900;
    }
    .sign span{ color: var(--pink); }

    .media{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:center;
      margin-top:12px;
    }
    .media img{
      width: min(360px, 88vw);
      border-radius:18px;
      border: var(--border);
      box-shadow: 0 12px 26px rgba(0,0,0,.10);
      object-fit:cover;
    }
    .caption{
      text-align:center;
      font-size:12.5px;
      opacity:.72;
      margin-top:8px;
    }

    .nav{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:16px;
      align-items:center;
      justify-content:space-between;

      position: sticky;
      bottom: 12px;
      background: rgba(255,255,255,.78);
      border: var(--border);
      border-radius: 18px;
      padding: 10px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
      z-index: 5;
    }
    .navTop{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
      align-items:center;
      justify-content:space-between;
    }

    button{
      border:0;
      border-radius:16px;
      padding:12px 14px;
      font-weight:950;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease;
      user-select:none;
    }
    button:hover{ transform: translateY(-1px); filter: brightness(1.02); }

    .btn{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:white;
      box-shadow: 0 12px 24px rgba(255,47,125,.22);
    }
    .btn2{
      background: rgba(0,0,0,.06);
      color:#333;
    }

    .yesArea{
      margin-top:16px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
    }
    .no-wrap{ position:relative; display:inline-block; }

    .sparkle{
      position:absolute;
      pointer-events:none;
      width:10px;height:10px;
      border-radius:50%;
      background: rgba(255,47,125,.7);
      transform: translate(-50%,-50%);
      animation: pop .55s ease-out forwards;
      filter: blur(.2px);
      z-index:999;
    }
    @keyframes pop{
      0%{ opacity:0; transform: translate(-50%,-50%) scale(.6); }
      20%{ opacity:1; }
      100%{ opacity:0; transform: translate(-50%,-70%) scale(1.6); }
    }

    .poem{
      line-height:1.9;
      font-size:15px;
    }
    .poem p{ margin: 12px 0; }

    /* Music pill */
    .musicPill{
      position:fixed;
      right:14px;
      bottom:14px;
      z-index:10;
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.78);
      border: var(--border);
      box-shadow: 0 10px 22px rgba(0,0,0,.10);
      backdrop-filter: blur(10px);
    }
    .musicDot{
      width:10px;height:10px;border-radius:50%;
      background: rgba(255,47,125,.9);
      box-shadow: 0 0 0 6px rgba(255,47,125,.12);
      opacity:.45;
    }
    .musicLabel{
      font-size:12.5px;
      font-weight:900;
      opacity:.85;
      white-space:nowrap;
    }
    .musicBtn{
      padding:10px 12px;
      border-radius:999px;
      font-weight:950;
    }

    audio{ width:100%; max-width:360px; }

    .tiny{
      font-size:12.5px;
      opacity:.7;
      margin-top:10px;
    }
    .assetRow{
      margin-top:10px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .assetTag{
      font-size:12px;
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.08);
      background: rgba(255,255,255,.72);
      opacity:.85;
    }
    .ok{ border-color: rgba(16,185,129,.35); }
    .bad{ border-color: rgba(239,68,68,.35); }
  </style>
</head>

<body>
  <script>
    const heartCount = 18;
    for(let i=0;i<heartCount;i++){
      const h=document.createElement('div');
      h.className='heart';
      h.style.left = Math.random()*100+'vw';
      h.style.animationDuration = (8+Math.random()*10)+'s';
      h.style.animationDelay = (-Math.random()*14)+'s';
      const s = 10 + Math.random()*18;
      h.style.width = s+'px';
      h.style.height = s+'px';
      h.style.opacity = 0.25 + Math.random()*0.45;
      document.body.appendChild(h);
    }
  </script>

  <!-- Background music (user taps Play once; phones block autoplay) -->
  <audio id="bgm" loop preload="none"></audio>

  <div class="musicPill" aria-label="music control">
    <div class="musicDot" id="musicDot"></div>
    <div class="musicLabel" id="musicLabel">Music: Off</div>
    <button class="btn2 musicBtn" id="musicToggle">Play</button>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="top">
        <div class="badge">üíå For <span id="herName"></span></div>
        <div class="progress" id="progress"></div>
      </div>

      <div id="scenes"></div>
    </div>
  </div>

  <script>
    // ===== Customize =====
    const NAME = "Shreya";
    const YOUR_NAME = "Samarpan";

    // Put these files in the SAME folder as index.html (repo root)
    const COUPLE_PHOTO = "us.jpg";        // or "us.png"
    const VOICE_MP3    = "shreya.mp3";    // if you have mp3
    const VOICE_M4A    = "shreya.m4a";    // if you have m4a instead
    const MUSIC_MP3    = "music.mp3";     // optional
    // =====================

    document.getElementById("herName").textContent = NAME;

    // cache-buster to defeat Safari/GitHub caching while you iterate
    const CB = `?v=${Date.now()}`;

    // --- Music controls ---
    const bgm = document.getElementById("bgm");
    bgm.src = MUSIC_MP3 + CB;

    const musicToggle = document.getElementById("musicToggle");
    const musicLabel  = document.getElementById("musicLabel");
    const musicDot    = document.getElementById("musicDot");

    function setMusicUI(isOn){
      musicLabel.textContent = "Music: " + (isOn ? "On" : "Off");
      musicToggle.textContent = isOn ? "Pause" : "Play";
      musicDot.style.opacity = isOn ? "1" : ".45";
    }
    setMusicUI(false);

    async function tryPlayMusic(){
      try{
        await bgm.play();
        localStorage.setItem("bgm_on","1");
        setMusicUI(true);
      }catch(e){
        setMusicUI(false);
      }
    }
    function pauseMusic(){
      bgm.pause();
      localStorage.setItem("bgm_on","0");
      setMusicUI(false);
    }
    musicToggle.addEventListener("click", async ()=>{
      if(bgm.paused) await tryPlayMusic();
      else pauseMusic();
    });

    // --- Floating nickname chips ---
    const nicknames = [
      {t:"Chalky", e:"üíò"},
      {t:"Sanu", e:"üåô"},
      {t:"Baby", e:"üíã"},
      {t:"Mrs Thapa", e:"üåπ"},
      {t:"Chalky", e:"ü´Ç"},
      {t:"Sanu", e:"üíû"},
      {t:"Baby", e:"üç´"},
      {t:"Mrs Thapa", e:"üß∏"},
      {t:"Chalky", e:"üòò"},
      {t:"Sanu", e:"‚ù§Ô∏è"}
    ];

    function spawnWord(){
      const w = document.createElement("div");
      w.className = "floatWord";
      const pick = nicknames[Math.floor(Math.random()*nicknames.length)];
      w.style.left = (6 + Math.random()*88) + "vw";
      w.style.top  = (70 + Math.random()*25) + "vh";
      const size = 12 + Math.random()*6;
      w.style.fontSize = size + "px";
      const dur = 12 + Math.random()*10;
      w.style.animationDuration = dur + "s";
      w.style.animationDelay = (-Math.random()*dur) + "s";
      w.style.opacity = (0.75 + Math.random()*0.25).toFixed(2);
      w.innerHTML = `<b>${pick.t}</b> ${pick.e}`;
      document.body.appendChild(w);
      setTimeout(()=>w.remove(), (dur+2)*1000);
    }
    for(let i=0;i<10;i++) spawnWord();
    setInterval(spawnWord, 1200);

    // --- sparkles ---
    function sparkle(x,y){
      const s=document.createElement('div');
      s.className='sparkle';
      s.style.left = x+'px';
      s.style.top = y+'px';
      document.body.appendChild(s);
      setTimeout(()=>s.remove(), 600);
    }

    // --- Asset check (helps debug media not loading) ---
    async function checkAsset(url){
      try{
        const r = await fetch(url, { method: "HEAD", cache: "no-store" });
        return r.ok;
      }catch(e){
        return false;
      }
    }

    // --- Scene template ---
    function tplScene({title, dayLabel="", pills=[], bodyHTML="", showPhoto=false, showVoice=false, final=false, isPoem=false}) {
      const wrap = document.createElement("div");
      wrap.className = "scene";

      const dayHTML = dayLabel ? `<div class="pillrow"><div class="pill">${dayLabel}</div></div>` : "";
      const pillsHTML = pills.length ? `<div class="pillrow">${pills.map(t=>`<div class="pill">${t}</div>`).join("")}</div>` : "";

      const poemTopNav = isPoem ? `
        <div class="navTop">
          <button class="btn2" id="prevBtnTop">‚Üê Back</button>
          <button class="btn" id="nextBtnTop">Next ‚Üí</button>
        </div>
      ` : "";

      const photoHTML = (showPhoto)
        ? `
          <div class="media">
            <img id="coupleImg" src="${COUPLE_PHOTO + CB}" alt="us" loading="lazy">
          </div>
          <div class="caption">You. Me. Same team.</div>
        ` : "";

      // Voice: include both mp3 + m4a sources, whichever exists will work
      const voiceHTML = (showVoice)
        ? `
          <div class="bubble" style="margin-top:14px; text-align:center;">
            <p style="margin:0; font-weight:950;">Press play.</p>
            <p style="margin:6px 0 12px; opacity:.75;">(Yes, it‚Äôs my voice.)</p>
            <audio controls preload="none">
              <source src="${VOICE_MP3 + CB}" type="audio/mpeg">
              <source src="${VOICE_M4A + CB}" type="audio/mp4">
              Your browser does not support audio playback.
            </audio>
            <div class="tiny" id="voiceHint"></div>
          </div>
        ` : "";

      wrap.innerHTML = `
        <h1>${title}</h1>
        ${dayHTML}
        ${pillsHTML}
        ${poemTopNav}
        <div class="bubble">${bodyHTML}</div>
        ${voiceHTML}
        ${photoHTML}
        ${final ? `
          <div class="yesArea">
            <button class="btn" id="yesBtn">YES üíû</button>
            <span class="no-wrap">
              <button class="btn2" id="noBtn">No üò∂</button>
            </span>
          </div>
          <div class="caption" id="noHint">You can answer honestly‚Ä¶ but that button is nervous.</div>
        ` : `
          <div class="nav">
            <button class="btn2" id="prevBtn">‚Üê Back</button>
            <button class="btn" id="nextBtn">Next ‚Üí</button>
          </div>
        `}
      `;

      return wrap;
    }

    // --- Content (closer to your earlier vibe: cute, romantic, funny ‚Äî not ‚Äúcorporate‚Äù) ---
    const VAL_WEEK = [
      {
        day: "Welcome",
        title: `Hi ${NAME}‚Ä¶ ü•∫üëâüëà`,
        dayLabel: "Just a small thing for you üíó",
        pills: ["Chalky", "Sanu", "Baby", "Mrs Thapa"],
        bodyHTML: `
          <p>I‚Äôm not going to ask you what you like. I already know. (Five years, remember? üòå)</p>
          <p>This is just me being a little extra‚Ä¶ because you deserve it.</p>
          <div class="note">
            <p style="margin:0;">
              One request: read it slowly.<br>
              And don‚Äôt roll your eyes too hard at the cute parts. I worked hard to be shameless.
            </p>
            <p class="sign">‚Äî Your impatient <span>${YOUR_NAME}</span> üíò</p>
          </div>
          <p class="tiny">Tip: hit Play for music if you want.</p>
        `
      },

      {
        day: "Rose Day",
        title: "Rose Day üåπ",
        dayLabel: "Rose Day",
        bodyHTML: `
          <p>If I was there, I‚Äôd give you a rose and pretend I‚Äôm smooth.</p>
          <p>Reality: I‚Äôd probably get shy, smile like an idiot, and still give it to you anyway.</p>
          <p>So here‚Äôs my rose from far away: üåπ</p>
          <p>Also yes, you‚Äôre still my favorite person. Annoying, but true.</p>
        `
      },

      {
        day: "Propose Day",
        title: "Propose Day üíç",
        dayLabel: "Propose Day",
        bodyHTML: `
          <p>This is not a public proposal. No audience. No drama. Just you and me.</p>
          <p>I propose that we keep doing this ‚Äî choosing each other even when distance acts like a villain.</p>
          <p>And I propose you let me miss you in peace‚Ä¶ because I‚Äôm going to do it anyway.</p>
        `
      },

      {
        day: "Chocolate Day",
        title: "Chocolate Day üç´",
        dayLabel: "Chocolate Day",
        bodyHTML: `
          <p>If I could deliver chocolate through the screen, I would.</p>
          <p>Since science is failing me, I‚Äôm sending you this instead:</p>
          <p><b>permission to be spoiled today.</b></p>
          <p>If you eat chocolate, I‚Äôm happy. If you don‚Äôt, I‚Äôm still happy‚Ä¶ but slightly suspicious.</p>
        `
      },

      {
        day: "Teddy Day",
        title: "Teddy Day üß∏",
        dayLabel: "Teddy Day",
        bodyHTML: `
          <p>I would 100% replace your teddy today if teleportation existed.</p>
          <p>Until then: imagine a long hug that doesn‚Äôt end too fast.</p>
          <p>Also I‚Äôm jealous of your pillow. It gets you every night. I‚Äôm not proud of this jealousy. But it exists.</p>
        `
      },

      {
        day: "Promise Day",
        title: "Promise Day ü§ù",
        dayLabel: "Promise Day",
        bodyHTML: `
          <p>I promise to keep loving you in the small ways ‚Äî the ones that actually matter.</p>
          <p>I promise to keep choosing you, even on boring days, even on tired days.</p>
          <p>And I promise I‚Äôll never forget our favorites:</p>
          <p>
            ‚Ä¢ our first date<br>
            ‚Ä¢ that full moon at Patan Mandir<br>
            ‚Ä¢ momo in Patan ko Galli
          </p>
        `
      },

      {
        day: "Poem",
        title: "üåô",
        dayLabel: "",
        pills: ["(a quiet page)"],
        isPoem: true,
        bodyHTML: `
          <p style="opacity:.85; font-style:italic; margin-top:0;">
            I found something I wrote years ago.<br>
            I won‚Äôt explain it.<br>
            I‚Äôll just leave it here.
          </p>

          <div class="poem">
            <p>
              If only I could own my dreams,<br>
              With sleepless night, I would trade all of it.<br>
              Telling the birds to sleep early and quiet,<br>
              Even the leaves wouldn‚Äôt make any noise.
            </p>

            <p>
              And here I hold my breath all so tight<br>
              For listening you breathe all whole night
            </p>

            <p>
              If morning were endless<br>
              And you drizzle like rain
            </p>

            <p>
              I could be an ocean receiving all your pain.
            </p>

            <p>
              Let the pain move like waves between shores of our souls<br>
              And embrace each other until it utterly goes
            </p>

            <p>
              Unite our soul, make it whole and make those pain never shows again<br>
              And tell our tale to the clouds as they listen cravingly, the pelting rain
            </p>

            <p>
              The worst things about mornings and nights,<br>
              They always end
            </p>

            <p>
              I pass the time in between, counting hours, till comes the another night<br>
              My heart, I love you with all my soul and with all my might
            </p>

            <p>
              Among all the loveliest things, you are the only one precious, I have.<br>
              For length of my love is far greater than length of my life
            </p>

            <p>
              Give me a little of you dear, and I will give you all of mine
            </p>

            <p>
              If I could stop my heart from loving you<br>
              Then I shall remain heartless<br>
              For there‚Äôs nothing I would rather do<br>
              Than spending my whole life loving only you.
            </p>

            <p style="margin-top:18px; font-weight:950;">
              ‚Äî ${YOUR_NAME}
            </p>
          </div>
        `
      },

      {
        day: "Hug Day",
        title: "Hug Day ü´Ç",
        dayLabel: "Hug Day",
        bodyHTML: `
          <p>This is the part where distance gets annoying.</p>
          <p>So here‚Äôs my long-distance hug protocol:</p>
          <p><b>Step 1:</b> imagine I‚Äôm hugging you.<br>
             <b>Step 2:</b> imagine I refuse to let go.<br>
             <b>Step 3:</b> accept your fate (being loved).</p>
          <p>I miss you. A lot. In a way that makes me dramatic in private.</p>
        `
      },

      {
        day: "Kiss Day",
        title: "Kiss Day üíã",
        dayLabel: "Kiss Day",
        bodyHTML: `
          <p>I owe you kisses. Too many.</p>
          <p>But first we must mention the historic moment:</p>
          <p><b>when I didn‚Äôt eat ice-cream through your mouth.</b></p>
          <p>I still don‚Äôt know what was going on in my brain. Fear? Respect? Survival?</p>
          <p>You were mad. I was confused. We were iconic. üò≠</p>
        `
      },

      {
        day: "Valentine",
        title: `${NAME}‚Ä¶ the big question üíò`,
        dayLabel: "Valentine",
        pills: ["Chalky", "Sanu", "Baby", "Mrs Thapa"],
        showVoice: true,
        showPhoto: true,
        final: true,
        bodyHTML: `
          <p>I don‚Äôt have ‚Äúreasons.‚Äù I just love you.</p>
          <p>Like‚Ä¶ the simple kind that stays. The kind that shows up. The kind that feels like home.</p>
          <div class="note">
            <p style="margin:0; font-weight:950;">Will you be my Valentine? üåπ</p>
            <p class="sign">‚Äî <span>${YOUR_NAME}</span></p>
          </div>

          <div class="assetRow" id="assetRow">
            <div class="assetTag" id="photoTag">Photo: checking‚Ä¶</div>
            <div class="assetTag" id="voiceTag">Voice: checking‚Ä¶</div>
            <div class="assetTag" id="musicTag">Music: checking‚Ä¶</div>
          </div>
          <div class="tiny" id="assetHint"></div>
        `
      }
    ];

    const scenesEl = document.getElementById("scenes");
    const progressEl = document.getElementById("progress");

    const sceneNodes = VAL_WEEK.map((d) => tplScene({
      title: d.title,
      dayLabel: d.dayLabel || "",
      pills: d.pills || [],
      bodyHTML: d.bodyHTML || "",
      showPhoto: !!d.showPhoto,
      showVoice: !!d.showVoice,
      final: !!d.final,
      isPoem: !!d.isPoem
    }));

    sceneNodes.forEach(n => scenesEl.appendChild(n));

    let idx = 0;

    function updateProgress(){
      progressEl.textContent = `${idx+1} / ${VAL_WEEK.length}`;
    }

    function bindNav(active){
      const prev = active.querySelector("#prevBtn");
      const next = active.querySelector("#nextBtn");
      if(prev) prev.onclick = (e)=>{ sparkle(e.clientX, e.clientY); show(idx-1); };
      if(next) next.onclick = (e)=>{ sparkle(e.clientX, e.clientY); show(idx+1); };

      const prevTop = active.querySelector("#prevBtnTop");
      const nextTop = active.querySelector("#nextBtnTop");
      if(prevTop) prevTop.onclick = (e)=>{ sparkle(e.clientX, e.clientY); show(idx-1); };
      if(nextTop) nextTop.onclick = (e)=>{ sparkle(e.clientX, e.clientY); show(idx+1); };
    }

    function bindFinal(active){
      const yes = active.querySelector("#yesBtn");
      const no  = active.querySelector("#noBtn");
      const hint = active.querySelector("#noHint");
      const wrap = active.querySelector(".no-wrap");

      let noDodges = 0;
      const noPhrases = [
        "Are you sure? ü•∫",
        "Wait wait wait üò≠",
        "That choice seems‚Ä¶ incorrect.",
        "Your finger slipped. Try again üòå",
        "Okay but what if‚Ä¶ yes? üò≥",
        "I‚Äôm gonna be sad (tiny) üòî",
        "That‚Äôs illegal actually üöîüíò",
        "The universe rejects this üåå",
        "I asked nicely though ü•π",
        "Last chance‚Ä¶ pretty please? üçì"
      ];

      function dodge(){
        noDodges++;
        if(hint) hint.textContent = noPhrases[Math.min(noDodges-1, noPhrases.length-1)];

        const cardRect = document.querySelector(".card").getBoundingClientRect();
        const maxX = Math.max(0, Math.min(220, cardRect.width - 180));
        const maxY = 50;

        const x = (Math.random()*maxX) - (maxX/2);
        const y = (Math.random()*maxY) - (maxY/2);

        if(wrap){
          wrap.style.transform = `translate(${x}px, ${y}px)`;
          wrap.style.transition = "transform .12s ease";
        }

        if(noDodges >= 10 && no) no.textContent = "I‚Äôm shy üôà";
        if(noDodges >= 14 && no){
          no.textContent = "Okay fine‚Ä¶ click me";
          no.removeEventListener("mouseenter", dodge);
          no.removeEventListener("touchstart", dodge);
        }
      }

      if(yes){
        yes.onclick = async (e)=>{
          sparkle(e.clientX, e.clientY);
          // If she already hit play earlier, try to keep it going after a click
          if(localStorage.getItem("bgm_on") === "1" && bgm.paused) await tryPlayMusic();
          alert(`YAY üíñ\n\nOfficially confirmed:\n${NAME} is my Valentine.\n\n‚Äî ${YOUR_NAME}`);
        };
      }
      if(no){
        no.addEventListener("mouseenter", dodge);
        no.addEventListener("touchstart", (e)=>{ e.preventDefault(); dodge(); }, {passive:false});
        no.onclick = (e)=>{
          sparkle(e.clientX, e.clientY);
          alert("Nice try üòå\nThis option has been politely rejected by the Romance Department‚Ñ¢.");
        };
      }
    }

    async function runAssetChecks(active){
      const row = active.querySelector("#assetRow");
      if(!row) return;

      const photoTag = active.querySelector("#photoTag");
      const voiceTag = active.querySelector("#voiceTag");
      const musicTag = active.querySelector("#musicTag");
      const hint = active.querySelector("#assetHint");

      const photoOK = await checkAsset(COUPLE_PHOTO + CB);
      const voiceMP3OK = await checkAsset(VOICE_MP3 + CB);
      const voiceM4AOK = await checkAsset(VOICE_M4A + CB);
      const musicOK = await checkAsset(MUSIC_MP3 + CB);

      photoTag.textContent = `Photo: ${photoOK ? "OK" : "NOT FOUND"}`;
      voiceTag.textContent = `Voice: ${(voiceMP3OK || voiceM4AOK) ? "OK" : "NOT FOUND"}`;
      musicTag.textContent = `Music: ${musicOK ? "OK" : "NOT FOUND"}`;

      photoTag.classList.toggle("ok", photoOK);
      photoTag.classList.toggle("bad", !photoOK);

      voiceTag.classList.toggle("ok", (voiceMP3OK || voiceM4AOK));
      voiceTag.classList.toggle("bad", !(voiceMP3OK || voiceM4AOK));

      musicTag.classList.toggle("ok", musicOK);
      musicTag.classList.toggle("bad", !musicOK);

      if(!photoOK || !(voiceMP3OK || voiceM4AOK)){
        hint.textContent =
          "If something says NOT FOUND: check the filename (lowercase), and make sure the file is in the repo root next to index.html. GitHub Pages is case-sensitive.";
      } else {
        hint.textContent = "";
      }
    }

    function show(i){
      idx = Math.max(0, Math.min(i, sceneNodes.length-1));
      document.querySelectorAll(".scene").forEach(s => s.classList.remove("active"));
      const active = sceneNodes[idx];
      active.classList.add("active");
      updateProgress();
      bindNav(active);
      bindFinal(active);

      // On the final page, run checks so we can see why media isn't loading
      runAssetChecks(active).catch(()=>{});

      window.scrollTo({top:0, behavior:"smooth"});
    }

    show(0);
  </script>
</body>
</html>
